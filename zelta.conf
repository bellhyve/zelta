# Zelta Policy Backup Configuration v1.1-beta3
#
# When "zelta policy" is called with no options, a backup batch job is called using this
# configuration file, which contains behavior options, backup sources and targets, and other
# miscellaneous options. Note that Zelta's global defaults, such as the snapshot naming format,
# must be configured with environment variables or in zelta.env.
#
# See below for examples and details about each option with the default option below each
# "Example:" line. For more information, see the README.md and wiki here:
#
# https://github.com/bellhyve/zelta
#
# This file is not feature-complete YAML and context-dependent options are interpreted in
# order. For example, site-specific options must appear before the host definitions. Also note
# that command line options will override ALL contexts.


### Global Options

# # Set a default backup target for source volumes with no specified target. For example,
# # a source defined as "  - source/vol" will be replicated to "BACKUP_ROOT/vol".
# # Example:  BACKUP_ROOT: backup.example.com:tank/Backups
# BACKUP_ROOT:

# # If SNAP_MODE is set to:
# #     IF_NEEDED  (Default) Snapshot the source only if necessary (new data written).
# #     ALWAYS     Always snapshot the source.
# #     SKIP       If a snapshot isn't necessary, skip replication entirely.
# #     OFF        (Or 0) Do not snapshot.
# # WARNING: This is NOT a replacement for a local snapshot policy!
# # Snapshot naming format is an eval of the environment variable ZELTA_SNAP_NAME. See
# # the default zelta.env for more information.
# # Example:  SNAP_MODE: SKIP
# SNAP_MODE: IF_NEEDED

# # If set to 1 or more, attempt to retry failed replications. We most commonly use a value of
# # "RETRY: 2" to recover from everyday network interruptions.
# # Example:  RETRY: 2
# RETRY: 0

# # If set to 0, skip intermediate snapshots and only replicate the latest possible snapshot. If
# # set to the default value of 1, replicate as much as possible.
# # Legacy alias: INTERMEDIATE
# # Example:  SEND_INTR: 0
# SEND_INTR: 1

# # If on, pass the "zfs send -R" flag which downloads past snapshots recursively up to the latest
# # match. If snapshots are always made with "zfs snapshot -r", "REPLICATE: 1" in conjunction with
# # "DEPTH: 1" will be more efficient by skipping recursive listings. SEND_INTR tends to be safer.
# # Example:  REPLICATE: 1
# REPLICATE: 0

# # Restrict the "zfs list" depth to this many levels. If used without REPLICATE, Zelta will produce more
# # shallow replications, e.g., if given "DEPTH: 2" and the target has the children "one/two/three", only
# # "one/two" will be replicated.
# # Example:  DEPTH: 3
# DEPTH: 0

# # Add this many elements up to the pool name underneath BACKUP_ROOT. For example, if given
# # "ADD_DATASET_PREFIX: 99" and source volume "one/two/three", the target will be: BACKUP_ROOT/one/two/three
# # Legacy alias: PREFIX
# # Example:  ADD_DATASET_PREFIX: 99
# ADD_DATASET_PREFIX: 0

# # Add the hostname as an element after BACKUP_ROOT, e.g., "BACKUP_ROOT/myhost/zroot". This setting
# # is recommended for configurations without unique volume names.
# # Legacy alias: HOST_PREFIX
# # Example:  ADD_HOST_PREFIX: 1
# ADD_HOST_PREFIX: 0

# # Replicate sources to the following host via SSH rather than a local pool.
# # Example:  PUSH_TO: backup.example.com
# PUSH_TO:

# # By default, or if only one Site has been defined, Zelta runs one replication job at a time. If
# # JOBS is set to 2 or more and multiple Sites are defined, Zelta will replicate from that many
# # Sites at a time. In the example below with "JOBS: 2", the hosts on NYC1 and DAL1 will replicate
# # simultaneously.
# # Legacy alias: THREADS
# # Example:  JOBS: 2
# JOBS: 0

# # Set the output mode. Use "json" for structured output useful for graphing backup history or
# # integration with monitoring systems.
# # Example:  LOG_MODE: json
# LOG_MODE: text

# # Exclude datasets or source snapshots matching the specified exclusion pattern. See zelta-options(7)
# # for pattern syntax.
# # Example:  EXCLUDE: */swap,@temp-*
# EXCLUDE:

# # The relative target path used for rotated clones. NOT YET IMPLEMENTED.
# # Example:  ARCHIVE_ROOT: backup.example.com:tank/Archives
# ARCHIVE_ROOT:


### Prune Options (Experimental)
# # These options control snapshot pruning behavior when using 'zelta prune'.

# # Days of older matches to skip before pruning.
# # Example:  KEEP_SNAP_DAYS: 30
# KEEP_SNAP_DAYS:

# # Number of old matches to skip before pruning.
# # Example:  KEEP_SNAP_NUM: 10
# KEEP_SNAP_NUM:

# # Disable range compression in prune output (output individual snapshots).
# # Example:  NO_RANGES: 1
# NO_RANGES:


### SITE, HOST, AND DATASET DEFINITIONS
#
# Note: There are no default site, host, or dataset definitions. Examples are provided below.
#
# Sites are top-level elements used for multi-threading replication jobs or for organizing this
# file. Consider creating a Site for each physical location or logical grouping.
#
# Hosts (indented two spaces) are connected to via SSH. Use "localhost" for local sources.
#
# Datasets are listed in YAML style with "  - pool/dataset" format. A target can be specified
# after a colon to override BACKUP_ROOT.


# # BASIC EXAMPLE
# # A simple site with hosts and their datasets.
#
# NYC1:
#   compute1.example.com:
#   - ssd01/jail/web
#   - ssd01/jail/db
#   - ssd01/vm/app
#   compute2.example.com:
#   - ssd02/jail/vpn


# # DATASETS WITH EXPLICIT TARGETS
# # Override BACKUP_ROOT for specific datasets, including remote targets.
#
# DAL1:
#   host01.example.com:
#   - zroot/jail/dc
#   - rust01/data/docs: space@backup.example.com:tank/Backups/host01/docs
#   localhost:
#   - tank/vm/local: failover.example.com:pool/vm/local


# # SITE-LEVEL OVERRIDES
# # Override global options for an entire site. Options must appear before host definitions.
#
# REMOTE_SITE:
#   SEND_INTR: 0
#   RETRY: 3
#   host03.example.com:
#   - zroot/jail/mail
#   - zroot/jail/web


# # HOST-LEVEL OVERRIDES
# # Use "options:" and "datasets:" blocks for per-host configuration.
#
# PROD_SITE:
#   db.example.com:
#     options:
#       ADD_HOST_PREFIX: 1
#       ADD_DATASET_PREFIX: 1
#       REPLICATE: 1
#       DEPTH: 1
#     datasets:
#       - zroot/db/primary
#       - zroot/db/replica
#   web.example.com:
#     datasets:
#       - ssd01/jail/nginx
#       - ssd01/jail/php


# # MIXED HOST FORMATS
# # Hosts can use either direct dataset lists or the datasets: block format.
#
# MIXED_SITE:
#   simple.example.com:
#   - pool/data
#   - pool/logs
#   complex.example.com:
#     options:
#       SNAP_MODE: ALWAYS
#     datasets:
#       - zroot/critical
