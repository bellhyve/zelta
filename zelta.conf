# Zelta Policy Backup Configuration v1.1-rc1
#
# This file configures "zelta policy" backup jobs. For global defaults that apply to all Zelta
# commands (zelta backup, zelta match, etc.), see zelta.env. For complete option documentation
# including the option hierarchy, run "zelta help options" or see zelta-options(7).
#
# See below for examples and details about each option. For more information:
#
# https://zelta.space/en/conf/policy-conf
#
# Options are interpreted top-to-bottom. Global options apply to all sites unless overridden.
# Site-level options override globals for that site. Host-level options override site options.
# Command-line arguments override everything.


### Global Options

# # Set a default backup target for source datasets with no specified target. For example,
# # a source defined as "  - source/vol" will be replicated to "BACKUP_ROOT/vol".
# # Example:  BACKUP_ROOT: backup.example.com:tank/Backups
# BACKUP_ROOT:

# # If SNAP_MODE is set to:
# #     IF_NEEDED  (Default) Snapshot the source only if necessary (new data written).
# #     ALWAYS     Always snapshot the source.
# #     OFF        (Or 0) Do not snapshot.
# # Snapshot naming is controlled by the SNAP_NAME option. To use a dynamic name such as
# # the output of 'date', use shell command substitution: SNAP_NAME: "$(date -u +%Y-%m-%d)"
# # Example:  SNAP_MODE: ALWAYS
# SNAP_MODE: IF_NEEDED

# # If set to 1 or more, attempt to retry failed replications. We most commonly use a value of
# # "RETRY: 2" to recover from everyday network interruptions.
# # Example:  RETRY: 2
# RETRY: 0

# # If set to 0, skip intermediate snapshots and only replicate the latest possible snapshot. If
# # set to the default value of 1, replicate as much as possible.
# # Legacy alias: INTERMEDIATE
# # Example:  SEND_INTR: 0
# SEND_INTR: 1

# # Restrict the "zfs list" depth to this many levels. If used without REPLICATE, Zelta will produce more
# # shallow replications, e.g., if given "DEPTH: 2" and the target has the children "one/two/three", only
# # "one/two" will be replicated.
# # Example:  DEPTH: 3
# DEPTH: 0

# # Add this many parent dataset elements underneath BACKUP_ROOT. For example, if given
# # "ADD_DATASET_PREFIX: 2" and source dataset "one/two/three", the target will be:
# # BACKUP_ROOT/two/three
# # Legacy alias: PREFIX
# # Example:  ADD_DATASET_PREFIX: 2
# ADD_DATASET_PREFIX: 0

# # Add the hostname as an element after BACKUP_ROOT, e.g., "BACKUP_ROOT/myhost/zroot". This setting
# # is recommended for configurations without unique dataset names.
# # Legacy alias: HOST_PREFIX
# # Example:  ADD_HOST_PREFIX: 1
# ADD_HOST_PREFIX: 0

# # For remote-to-remote replication, set the sync direction. PULL (default) has the target
# # connect to the source. PUSH has the source connect to the target.
# # Example:  SYNC_DIRECTION: PUSH
# SYNC_DIRECTION: PULL

# # By default, or if only one Site has been defined, Zelta runs one replication job at a time. If
# # JOBS is set to 2 or more and multiple Sites are defined, Zelta will replicate from that many
# # Sites at a time. In the example below with "JOBS: 2", the hosts on NYC1 and DAL1 will replicate
# # simultaneously.
# # Legacy alias: THREADS
# # Example:  JOBS: 2
# JOBS: 0

# # Set the output mode. Use "json" for structured output useful for graphing backup history or
# # integration with monitoring systems.
# # Example:  LOG_MODE: json
# LOG_MODE:

# # Exclude datasets or source snapshots matching the specified exclusion pattern. See zelta-options(7)
# # for pattern syntax.
# # Example:  EXCLUDE: */swap,@temp-*
# EXCLUDE:


### SITE, HOST, AND DATASET DEFINITIONS
#
# Note: There are no default site, host, or dataset definitions. Examples are provided below.
#
# Sites are top-level elements used for multi-threading replication jobs or for organizing this
# file. Consider creating a Site for each physical location or logical grouping.
#
# Hosts (indented two spaces) are connected to via SSH. Use "localhost" for local sources.
#
# Datasets are listed in YAML style with "  - pool/dataset" format. A target can be specified
# after a colon to override BACKUP_ROOT.


# # BASIC EXAMPLE
# # A simple site with hosts and their datasets.
#
# NYC1:
#   compute1.example.com:
#   - ssd01/jail/web
#   - ssd01/jail/db
#   - ssd01/vm/app
#   compute2.example.com:
#   - ssd02/jail/vpn


# # DATASETS WITH EXPLICIT TARGETS
# # Override BACKUP_ROOT for specific datasets, including remote targets.
#
# DAL1:
#   host01.example.com:
#   - zroot/jail/dc
#   - rust01/data/docs: space@backup.example.com:tank/Backups/host01/docs
#   localhost:
#   - tank/vm/local: failover.example.com:pool/vm/local


# # SITE-LEVEL OVERRIDES
# # Override global options for an entire site. Options must appear before host definitions.
#
# REMOTE_SITE:
#   SEND_INTR: 0
#   RETRY: 3
#   host03.example.com:
#   - zroot/jail/mail
#   - zroot/jail/web


# # HOST-LEVEL OVERRIDES
# # Use "options:" and "datasets:" blocks for per-host configuration.
#
# PROD_SITE:
#   db.example.com:
#     options:
#       ADD_HOST_PREFIX: 1
#       ADD_DATASET_PREFIX: 1
#       DEPTH: 1
#     datasets:
#       - zroot/db/primary
#       - zroot/db/replica
#   web.example.com:
#     datasets:
#       - ssd01/jail/nginx
#       - ssd01/jail/php


# # MIXED HOST FORMATS
# # Hosts can use either direct dataset lists or the datasets: block format.
#
# MIXED_SITE:
#   simple.example.com:
#   - pool/data
#   - pool/logs
#   complex.example.com:
#     options:
#       SNAP_MODE: ALWAYS
#     datasets:
#       - zroot/critical
