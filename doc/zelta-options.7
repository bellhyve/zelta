.\" Automatically generated by Pandoc 3.8.3
.\"
.TH "zelta\-options" "7" "" "" "System Manager\(cqs Manual"
.SH NAME
\f[B]zelta\-options\f[R] \- environment and policy options for Zelta
behavior
.SH SYNOPSIS
Environment variables and policy configuration options for controlling
Zelta\(cqs behavior across all commands.
.SH DESCRIPTION
Zelta\(cqs behavior can be modified through environment variables,
command\-line arguments, and policy configuration files.
This manual documents all available options and their effects.
.PP
Options set in the user environment must be prefixed with the string
\f[CR]ZELTA_\f[R].
For example, to override the default \f[CR]zelta.env\f[R], export the
variable \f[CR]ZELTA_ENV=\(dq/path/to/env\(dq\f[R].
In other contexts (like \f[CR]zelta.env\f[R] or \f[CR]zelta.conf\f[R]),
the \f[CR]ZELTA_\f[R] prefix can be omitted.
.PP
Options follow a hierarchy:
.IP
.EX
1. Defaults
2. \(gazelta.env\(ga
3. \(gazelta.conf\(ga (\(gazelta policy\(ga only)
4. Environment variables (must prefix names with \(gaZELTA_\(ga)
5. Command\-line arguments
.EE
.SH SETUP OPTIONS
The following options are often modified for user\-specific
installations and testing purposes.
Note that if \f[CR]ENV\f[R] and/or \f[CR]ETC\f[R] need to be overridden,
this must typically be done in the user environment using
\f[CR]ZELTA_ENV\f[R] and \f[CR]ZELTA_ETC\f[R] respectively.
.TP
\f[B]AWK\f[R]
The \f[B]awk\f[R] executable.
The default is the awk in the path.
Example: \f[CR]AWK=\(aqmawk \-Wi\(aq\f[R].
.TP
\f[B]SHARE\f[R]
The location of Zelta assets including the AWK scripts and data files.
The default is \f[CR]/usr/local/share/zelta\f[R].
.TP
\f[B]ETC\f[R]
The location of \f[CR]zelta.env\f[R] and \f[CR]zelta.conf\f[R].
The default is \f[CR]/usr/local/etc/zelta\f[R].
.TP
\f[B]ENV\f[R]
The exact path of \f[CR]zelta.env\f[R].
.TP
\f[B]DOC\f[R]
The location of Zelta\(cqs manpages.
Default is unset, using the system\-wide manual.
.SH LOGGING OPTIONS
.TP
\f[B]LOG_FILE\f[R]
Divert all output into the indicated file.
.TP
\f[B]LOG_LEVEL\f[R]
Specify a log level value 0\-4: errors (0), warnings (1), notices (2,
default), info (3, verbose), and debug (4).
.TP
\f[B]LOG_MODE\f[R]
Enable the specified log modes.
Currently supported: `text' (default) and `json'
(\f[CR]zelta backup\f[R] related verbs only).
.SH SSH OPTIONS
.TP
\f[B]REMOTE_COMMAND\f[R]
The remote shell command.
Defaults to \f[CR]ssh\f[R].
.TP
\f[B]REMOTE_DEFAULT\f[R]
The default remote shell command used for misc operations which should
prevent reading from stdin.
Defaults to \f[CR]REMOTE_COMMAND \-n\f[R] (\f[CR]ssh \-n\f[R]).
.TP
\f[B]REMOTE_SEND\f[R]
The remote shell command used for \f[CR]zfs send\f[R].
Defaults to \f[CR]REMOTE_COMMAND\f[R] (\f[CR]ssh\f[R]).
.TP
\f[B]REMOTE_RECV\f[R]
The remote shell command used for \f[CR]zfs recv\f[R].
Defaults to \f[CR]REMOTE_DEFAULT\f[R] (\f[CR]ssh \-n\f[R]).
.SH GENERAL OPTIONS
.TP
\f[B]DEPTH\f[R]
Limit the recursion depth of operations to the number of levels
indicated.
For example, a depth of 1 will only include the indicated
\f[I]source\f[R] dataset.
.TP
\f[B]EXCLUDE\f[R]
Exclude a comma\-delimited list of dataset suffixes anchored with a
\f[CR]/\f[R], like \f[CR]/dataset/suffix\f[R], or snapshots anchored
with a \f[CR]\(at\f[R], like \f[CR]\(atsnapshot\f[R].
Wild card matches with \f[CR]?\f[R] and \f[CR]*\f[R] are permitted.
.RS
Given a \f[I]source\f[R] endpoint \f[CR]sink\f[R] and the setting
\f[CR]EXCLUDE=\(aq/*/swap,#*,\(at*_hourly,/temp\(aq\f[R]:
.TP
\f[CR]\(at*_hourly\f[R]
All snapshots ending with \f[CR]_hourly\f[R] would be excluded as sync
candidates.
.TP
\f[CR]/*/swap\f[R]
All datasets ending with \f[CR]/swap\f[R] will be ignored.
.TP
\f[CR]/temp\f[R]
The \f[CR]sink/temp\f[R] dataset will be ignored; however a
\f[CR]sink/ds/temp\f[R] would still be synced.
.RE
.SH ZELTA MATCH OPTIONS
.TP
\f[B]SCRIPTING_MODE\f[R]
Suppress column headers and separate columns with a single tab.
Useful for parsing output in scripts.
.TP
\f[B]PARSABLE\f[R]
Output sizes in exact numbers instead of human\-readable values like
\f[CR]1M\f[R].
.TP
\f[B]PROPLIST\f[R]
Specify a list of \f[CR]zelta match\f[R] columns.
See \f[B]zelta\-match(8)\f[R] for more detail.
.TP
\f[B]LIST_WRITTEN\f[R]
Calculate data sizes for datasets and snapshots in the summary.
Enabled by default.
.TP
\f[B]CHECK_TIME\f[R]
Calculate the time of each \f[CR]zfs list\f[R] operation.
.SH ZFS SEND/RECEIVE OPTIONS
.TP
\f[B]SEND_OVERRIDE\f[R]
Override all \f[CR]zfs send\f[R] options with those indicated.
For precise and flexible configuration for different circumstances, use
the \f[CR]SEND_*\f[R] variables below instead.
.TP
\f[B]SEND_DEFAULT\f[R]
Options used for unencrpyted filesystems and volumes.
Defaults to \f[CR]\-Lce\f[R].
.TP
\f[B]SEND_RAW\f[R]
Options used for encrypted datasets.
Defaults to \f[CR]\-Lw\f[R].
.TP
\f[B]SEND_NEW\f[R]
Additional option used for new datasets.
Defaults to \f[CR]\-p\f[R].
.TP
\f[B]SEND_INTR\f[R]
Toggle option to transmit intermediate snapshots (\f[CR]1\f[R], the
default) or incremental (\f[CR]0\f[R]).
.TP
\f[B]SEND_REPLICATE\f[R]
Options to use in \f[CR]zelta replicate\f[R] mode.
Defaults to \f[CR]\-LsRw1\f[R].
.TP
\f[B]SEND_CHECK\f[R]
Attempt to drop unsupported \f[CR]zfs send\f[R] options using a no\-op
test prior to replication.
This feature is not fully implemented.
.TP
\f[B]RECV_OVERRIDE\f[R]
Override all \f[CR]zfs receive\f[R] options with those indicated.
For precise and flexible configuration, use the \f[CR]RECV_*\f[R]
variables instead.
.TP
\f[B]RECV_DEFAULT\f[R]
Default \f[CR]zfs recv\f[R] options.
Defaults to none.
.TP
\f[B]RECV_TOP\f[R]
Additional options for the top dataset.
Defaults to \f[CR]\-o readonly=on\f[R].
.TP
\f[B]RECV_FS\f[R]
Additional options for filesystems.
Defaults to \f[CR]\-u \-x mountpoint \-o canmount=noauto\f[R].
.TP
\f[B]RECV_VOL\f[R]
Additional options for volumes.
Defaults to none.
.TP
\f[B]RECV_PARTIAL\f[R]
Additional options if RESUME is enabled.
Defaults to \f[CR]\-s\f[R].
.TP
\f[B]RECV_PREFIX\f[R]
Pipe output through the indicated command, such as
\f[CR]dd status=progress\f[R].
.TP
\f[B]RESUME\f[R]
Enable (\f[CR]1\f[R], the default) or disable automatic resume of
interrupted syncs.
.SH REPLICATION OPTIONS
.TP
\f[B]SNAP_NAME\f[R]
Specify a snapshot name.
Use the form \f[CR]$(my_snapshot_program)\f[R] to use a dynamically
generated snapshot.
The default is \f[CR]$(date \-u +zelta_%Y\-%m\-%d_%H.%M.%S)\f[R].
.TP
\f[B]SNAP_MODE\f[R]
Specify when to snapshot during a \f[CR]zelta backup\f[R] operation.
Options: \f[CR]0\f[R] (never), \f[CR]IF_NEEDED\f[R] (default, only if
source has new data), or \f[CR]ALWAYS\f[R].
.TP
\f[B]SYNC_DIRECTION\f[R]
If both endpoints are remote, use \f[CR]PULL\f[R] (the default) or
\f[CR]PUSH\f[R] sync.
If set to \f[CR]0\f[R], traffic will stream through the local host.
Note that this feature PUSH and PULL features require appropriate ssh
configurations with keys properly installed and/or ssh agent forwarding
enabled.
.SH CLONE OPTIONS
.TP
\f[B]CLONE_DEFAULT\f[R]
Options for recursive cloning.
Defaults to \f[CR]\-po readonly=off\f[R].
.SH POLICY OPTIONS
.TP
\f[B]RETRY\f[R]
Retry failed syncs the indicated number of times.
.TP
\f[B]JOBS\f[R]
Run the indicated number of policy jobs concurrently, one for each Site
in the configuration.
.TP
\f[B]BACKUP_ROOT\f[R]
The relative target path for backup jobs.
For example, \f[CR]bkhost:tank/Backups\f[R] would place backups below
that dataset (if not overridden by policy).
.TP
\f[B]ARCHIVE_ROOT\f[R]
NOT YET IMPLEMENTED.
The relative target path used for rotated clones.
.TP
\f[B]HOST_PREFIX\f[R]
Include the source hostname as a parent of the synced target, for
example, \f[CR]tank/Backups/source.host/backup\-dataset\f[R].
.TP
\f[B]DS_PREFIX\f[R]
Similar to \f[CR]zfs recv \-d\f[R] and \f[CR]\-e\f[R], include the
indicated number of parent labels for the target\(cqs synced name.
See \f[B]zelta\-backup(8)\f[R] for more detail.
.SH EXAMPLES
Set options via environment for a one\-off run:
.IP
.EX
export ZELTA_LOG_LEVEL=4
export ZELTA_REMOTE_COMMAND=\(dqssh \-p 2202\(dq
zelta backup pool/dataset remote:pool/backup
.EE
.PP
Configure \f[CR]zelta.conf\f[R]:
.IP
.EX
# In zelta.conf, variables act as policy scopes but
# use the same option names.
LOG_MODE: json
JOBS: 2

NYC1:
  BACKUP_ROOT: backuphost:tank/Backups
  RETRY: 3
.EE
.SH SEE ALSO
\f[B]zelta(8)\f[R], \f[B]zelta\-backup(8)\f[R],
\f[B]zelta\-clone(8)\f[R], \f[B]zelta\-match(8)\f[R],
\f[B]zelta\-policy(8)\f[R], \f[B]zelta\-rotate(8)\f[R],
\f[B]zelta\-sync(8)\f[R], \f[B]cron(8)\f[R], \f[B]ssh(1)\f[R],
\f[B]zfs(8)\f[R]
.SH AUTHORS
Daniel J. Bell <\f[I]bellhyve\(atzelta.space\f[R]>
.SH WWW
https://zelta.space
