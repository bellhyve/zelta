.\" Automatically generated by Pandoc 3.8.3
.\"
.TH "zelta\-rotate" "8" "" "" "System Manager\(cqs Manual"
.SH NAME
\f[B]zelta rotate\f[R] \- recover sync continuity by renaming, cloning,
and incrementally syncing a ZFS replica
.SH DESCRIPTION
\f[B]zelta rotate\f[R] renames a target replica and performs a
multi\-way clone and sync operation to restore sync continuity when a
source and target have diverged.
This technique is a non\-destructive alternative to
\f[CR]zfs rollback\f[R] and \f[CR]zfs recv \-F\f[R], useful for
maintaining forensic evidence in recovery scenarios and advanced
iterative infrastructure workflows.
.PP
As with \f[CR]zelta backup\f[R], \f[CR]zelta rotate\f[R] works
recursively on dataset trees.
Both source and target may be local or remote via \f[B]ssh(1)\f[R].
.PP
The rotate operation syncs the minimum data necessary to complete the
task, targeting the next available snapshot for incremental replication.
After successful rotation, run \f[CR]zelta backup\f[R] with your
preferred settings to ensure full consistency.
.SS Rotation Process
\f[B]zelta rotate\f[R] performs these operations:
.IP "1." 3
\f[B]Snapshot Creation\f[R]: If the source has uncommitted changes, a
new snapshot is created (unless \f[CR]\-\-no\-snapshot\f[R] is
specified).
.IP "2." 3
\f[B]Match Detection\f[R]: Zelta searches for common snapshots between
source and target.
If none are found, it checks the source origin (the dataset from which
the source was cloned).
.IP "3." 3
\f[B]Target Preservation\f[R]: The target is renamed by appending the
matching snapshot name.
For example, \f[CR]pool/ds\f[R] with matching snapshot
\f[CR]\(atyesterday\f[R] becomes \f[CR]pool/ds_yesterday\f[R].
Note that no properties, including mountpoint and readonly status, are
altered.
.IP "4." 3
\f[B]Incremental Sync\f[R]: For each child dataset with a matching
snapshot, Zelta creates a clone at the target and performs an
incremental sync.
.IP "5." 3
\f[B]Full Backup\f[R]: For child datasets without matching snapshots, a
full backup is performed.
.SS Limitations
If the topmost target dataset has no common snapshot with either the
source or source origin, \f[CR]zelta rotate\f[R] will not continue.
In this case, manually rename the diverged target and use
\f[CR]zelta backup\f[R] to perform a full replication.
.PP
Remote dataset endpoints follow \f[B]scp(1)\f[R] conventions.
Dataset names follow \f[B]zfs(8)\f[R] naming conventions.
The target must be a replica of the source.
.PP
Examples:
.IP
.EX
Local:  pool/dataset
Remote: user\(atexample.com:pool/dataset
.EE
.SH OPTIONS
\f[B]Endpoint Arguments (Required)\f[R]
.PP
If both endpoints are remote, the default behavior is \f[B]pull
replication\f[R] (\f[CR]\-\-pull\f[R]).
This requires that the target user have ssh access to the source,
typically provided by ssh keys or agent forwarding.
For advanced ssh configuration, see \f[I]https://zelta.space\f[R].
.TP
\f[I]source\f[R]
The dataset to replicate.
The source origin, if needed, is automatically detected.
.TP
\f[I]target\f[R]
The replica dataset to be rotated.
.PP
\f[B]Output Options\f[R]
.TP
\f[B]\-v, \-\-verbose\f[R]
Increase verbosity.
Specify once for operational detail, twice (\f[CR]\-vv\f[R]) for debug
output.
.TP
\f[B]\-q, \-\-quiet\f[R]
Quiet output.
Specify once to suppress warnings, twice (\f[CR]\-qq\f[R]) to suppress
errors.
.TP
\f[B]\-n, \-\-dryrun, \-\-dry\-run\f[R]
Display \f[CR]zfs\f[R] commands without executing them.
.PP
\f[B]Connection Options\f[R]
.TP
\f[B]\-\-push, \-\-pull, \-\-sync\-direction\f[R] \f[I]DIRECTION\f[R]
When both endpoints are remote, use \f[CR]PULL\f[R] (default) or
\f[CR]PUSH\f[R] sync direction.
.PP
\f[B]Snapshot Options\f[R]
.TP
\f[B]\-\-no\-snapshot\f[R]
Do not create snapshots.
If a snapshot is needed for rotation, the operation will fail.
.TP
\f[B]\-\-snapshot\f[R]
Force snapshot creation even if the source has no uncommitted changes.
.TP
\f[B]\-\-snap\-name\f[R] \f[I]NAME\f[R]
Specify snapshot name.
Use \f[CR]$(command)\f[R] for dynamic generation.
Default: \f[CR]$(date \-u +zelta_%Y\-%m\-%d_%H.%M.%S)\f[R].
.SH EXAMPLES
A common workflow after accidentally diverging a source from its backup:
.PP
First, rewind the source to its previous snapshot state using a rename
and clone operation:
.IP
.EX
zelta revert sink/source/dataset
.EE
.PP
Then rotate the target replica, performing a 4\-way incremental sync to
match the reverted source:
.IP
.EX
zelta rotate sink/source/dataset backup\-host.example:tank/target/dataset
.EE
.PP
Finally, ensure full consistency between source and target:
.IP
.EX
zelta backup sink/source/dataset backup\-host.example:tank/target/dataset
.EE
.PP
The original diverged datasets remain accessible as
\f[CR]sink/source/dataset_<snapshot>\f[R] and
\f[CR]tank/target/dataset_<snapshot>\f[R] for forensic analysis.
.SH EXIT STATUS
Returns 0 on success, non\-zero on error.
.SH NOTES
See \f[B]zelta\-options(8)\f[R] for environment variables,
\f[CR]zelta.env\f[R] configuration, and \f[CR]zelta policy\f[R]
integration.
.SH SEE ALSO
zelta(8), zelta\-options(7), zelta\-match(8), zelta\-backup(8),
zelta\-policy(8), zelta\-clone(8), zelta\-revert(8), ssh(1), zfs(8),
zfs\-allow(8)
.SH AUTHORS
Daniel J. Bell <\f[I]bellhyve\(atzelta.space\f[R]>
.SH WWW
https://zelta.space
