.\" Automatically generated by Pandoc 3.8.3
.\"
.TH "zelta\-backup" "8" "" "" "System Manager\(cqs Manual"
.SH NAME
\f[B]zelta backup\f[R], \- replicate ZFS dataset trees
.SH SYNOPSIS
\f[B]zelta backup\f[R] [\f[I]OPTIONS\f[R]] \f[I]source\f[R]
\f[I]target\f[R]
.SH DESCRIPTION
\f[B]zelta backup\f[R] syncs snapshots from a \f[I]source\f[R] ZFS
dataset to a \f[I]target\f[R] dataset, working recursively on a dataset
tree.
Both \f[I]source\f[R] and \f[I]target\f[R] may be local or remote via
\f[B]ssh(1)\f[R].
Remote endpoints follow \f[B]scp(1)\f[R] conventions:
[user\(at]host:dataset.
.PP
\f[B]zelta backup\f[R] optimizes for complete, safe replication
including intermediate snapshots.
The synonym \f[B]zelta sync\f[R] performs incremental syncs excluding
intermediate snapshots, and the synonym \f[B]zelta replicate\f[R] uses
the \f[B]zfs send \-\-replicate\f[R] option instead of Zelta\(cqs
per\-snapshot analysis.
.PP
As with \f[B]zfs receive\f[R], the \f[I]target\f[R] dataset must not
exist or must be a replica of the \f[I]source\f[R].
.PP
To ensure safe operation, the following defaults are set for a new sync
\f[I]target\f[R] dataset:
.IP
.EX
1. The property \(gareadonly=on\(ga is set on the top (indicated) filesystem
2. Filesystems are not mounted
3. On filesystems, property \(gacanmount=noauto\(ga is set
4. On filesystems, mountpoints are inherited to prevent overlapping mounts
.EE
.PP
See \f[B]zelta\-options(8)\f[R] for more information.
.SH OPTIONS
.TP
\f[B]\-v, \-\-verbose\f[R]
Increase verbosity.
Specify once for operational detail, twice (\f[CR]\-vv\f[R]) for debug
output.
.TP
\f[B]\-q, \-\-quiet\f[R]
Quiet output.
Specify once to suppress warnings, twice (\f[CR]\-qq\f[R]) to suppress
errors.
.TP
\f[B]\-n, \-\-dryrun, \-\-dry\-run\f[R]
Display \f[CR]zfs\f[R] commands without executing them.
.TP
\f[B]\-d, \-\-depth\f[R] \f[I]LEVELS\f[R]
Limit recursion depth.
For example, a depth of 1 includes only the specified dataset.
.TP
\f[B]\-\-exclude, \-X\f[R] \f[I]PATTERN\f[R]
Exclude /dataset/suffix, \(atsnapshot, or #bookmark beginning with the
indicated symbol.
Wildcards \f[CR]?\f[R] and \f[CR]*\f[R] are permitted.
See \f[B]zelta\-match(8)\f[R].
.TP
\f[B]\-j, \-\-json\f[R]
Print JSON output.
See \f[B]zelta\-options(8)\f[R] for details.
.TP
\f[B]\-b,\-\-backup,\-c,\-\-compressed,\-D,\-\-dedup,\-e,\-\-embed,\-h,\-\-holds,\-L,\-\-largeblock,\-p,\-\-parsable,\-\-proctitle,\-\-props,\-\-raw,\-\-skipmissing,\-V,\-w\f[R]
Override default \f[CR]zfs send\f[R] options.
For precise configuration, use \f[CR]ZELTA_SEND_*\f[R] environment
variables instead.
See \f[B]zelta\-options(8)\f[R].
.TP
\f[B]\-\-send\-check\f[R]
Attempt to drop unsupported \f[CR]zfs send\f[R] options using a no\-op
test prior to replication.
Not fully implemented.
.TP
\f[B]\-e,\-h,\-M,\-u\f[R]
Override default \f[CR]zfs receive\f[R] options.
For precise configuration, use \f[CR]ZELTA_RECV_*\f[R] environment
variables instead.
See \f[B]zelta\-options(8)\f[R].
.TP
\f[B]\-\-rotate\f[R]
Rename the target dataset and sync a clone via delta from the source or
source origin clone.
See \f[B]zelta help rotate\f[R].
.TP
\f[B]\-R, \-\-replicate\f[R]
Use \f[B]zfs send \-\-replicate\f[R] instead of Zelta\(cqs per\-snapshot
analysis.
.TP
\f[B]\-I\f[R]
Sync all possible source snapshots using \f[CR]zfs send \-I\f[R] for
updates.
When disabled, only the newest snapshots are synced.
This is the default behavior for \f[B]zelta backup\f[R].
.TP
\f[B]\-\-resume,\-\-no\-resume\f[R]
Enable (default) or disable automatic resume of interrupted syncs.
.TP
\f[B]\-\-no\-snapshot\f[R]
Do not snapshot.
.TP
\f[B]\-\-snapshot\-always\f[R]
Snapshot even if the \f[I]source\f[R] has no written data in need of
one.
.TP
\f[B]\-\-snap\-name\f[R] \f[I]NAME\f[R]
Specify snapshot name.
Use \f[CR]$(command)\f[R] for dynamic generation.
Default: \f[CR]$(date \-u +zelta_%Y\-%m\-%d_%H.%M.%S)\f[R].
.TP
\f[B]\-\-snap\-mode\f[R] \f[I]MODE\f[R]
Specify when to snapshot: \f[CR]0\f[R] (never), \f[CR]IF_NEEDED\f[R]
(default, only if source has new data), or \f[CR]ALWAYS\f[R].
.TP
\f[B]\-\-push,\-\-pull,\-\-sync\-direction\f[R] \f[I]DIRECTION\f[R]
When both endpoints are remote, use \f[CR]PULL\f[R] (default) or
\f[CR]PUSH\f[R] sync direction.
.TP
\f[B]\-\-recv\-pipe\f[R] \f[I]COMMAND\f[R]
Pipe \f[CR]zfs receive\f[R] output through the indicated command, such
as \f[CR]dd status=progress\f[R].
.SH EXAMPLES
The same command works for both new and existing target datasets.
.PP
Local replication with automatic snapshot creation:
.IP
.EX
zelta backup tank/source/dataset tank/target/dataset
.EE
.PP
Remote to local synchronization:
.IP
.EX
zelta sync remote_host:tank/source/dataset tank/target/dataset
.EE
.PP
Dry run to preview commands:
.IP
.EX
zelta backup \-n tank/source/dataset tank/target/dataset
.EE
.PP
Replicate with custom snapshot naming:
.IP
.EX
zelta backup \(rs\-\-snap\-name \(dqbackup_$(date +%Y%m%d)\(dq \(rs
    tank/source tank/backups/source
.EE
.PP
Limit recursion depth:
.IP
.EX
zelta backup \-d 2 tank/source tank/target
.EE
.SH EXIT STATUS
Returns 0 on success, non\-zero on error.
.SH SEE ALSO
\f[B]zelta(8)\f[R], \f[B]zelta\-clone(8)\f[R],
\f[B]zelta\-match(8)\f[R], \f[B]zelta\-options(8)\f[R],
\f[B]zelta\-policy(8)\f[R], \f[B]zelta\-rotate(8)\f[R],
\f[B]zelta\-sync(8)\f[R], \f[B]ssh(1)\f[R], \f[B]zfs(8)\f[R]
.SH AUTHORS
Daniel J. Bell \f[I]\c
.MT bellta@belltower.it
.ME \c
\f[R]
.SH WWW
https://zelta.space
.PP
https://github.com/bellhyve/zelta
