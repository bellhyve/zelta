.\" Automatically generated by Pandoc 3.8.3
.\"
.TH "zelta\-backup" "8" "" "" "System Manager\(cqs Manual"
.SH NAME
\f[B]zelta backup\f[R], \- replicate ZFS dataset trees
.SH SYNOPSIS
\f[B]zelta backup\f[R] [\f[I]OPTIONS\f[R]] \f[I]source\f[R]
\f[I]target\f[R]
.SH DESCRIPTION
\f[B]zelta backup\f[R] recursively syncs snapshots from a
\f[I]source\f[R] ZFS dataset to a \f[I]target\f[R] dataset.
Both \f[I]source\f[R] and \f[I]target\f[R] may be local or remote via
\f[B]ssh(1)\f[R].
Remote endpoints follow \f[B]scp(1)\f[R] conventions:
[user\(at]host:dataset.
.PP
\f[B]zelta backup\f[R] optimizes for complete, safe replication
including intermediate snapshots.
As with \f[CR]zfs recv\f[R], the \f[I]target\f[R] dataset must be a
replica of the \f[I]soruce\f[R] or must not exist.
.PP
Prior to sync, \f[CR]zelta backup\f[R] performs the following operations
to ensure optimal \f[CR]zfs send/zfs recv\f[R] options are automatically
selected.
.IP
.EX
1. The properties of the _source_ and _target_ are checked using \(gazfs get\(ga.
2. If the _target_ dataset\(aqs parent does not exist, it will be created with \(gazfs create\(ga.
3. Using \(gazelta match\(ga, a snapshot GUID comparison is performed with \(gazfs list\(ga.
4. One or more \(gazfs send/zfs recv\(ga operations will be performed to update the _target_.
.EE
.PP
The following \f[CR]zfs send\f[R] options will be automatically used:
.IP
.EX
• Default: \-\-large\-block, \-\-compressed, \-\-embed
• Encrypted: \-\-large\-block, \-\-raw
• New/Full syncs: Add \-\-props
• Incremental syncs: Add \-I (override with \-i)
• If \-R is used: \-\-replicate, \-\-large\-block, \-\-raw, \-\-skip\-missing
.EE
.PP
To ensure safe, repeatable, and efficienct operation, the following
defaults are set for a new \f[I]target\f[R] dataset:
.IP
.EX
1. The property \(gareadonly=on\(ga is set on the top (indicated) filesystem
2. Filesystems are not mounted
3. On filesystems, property \(gacanmount=noauto\(ga is set
4. On filesystems, mountpoints are inherited to prevent overlapping mounts
.EE
.PP
Remote dataset endpoints follow \f[B]scp(1)\f[R] conventions:
[user\(at]host:[dataset], and require standard ZFS utilities and SSH
access.
Note that Zelta does \f[B]not\f[R] need to be installed on remote ZFS
servers.
.PP
Examples:
.IP
.EX
Local:  zpool/dataset\(atsnapshot
Remote: user\(atexample.com:zpool/dataset\(atsnapshots
.EE
.SH OPTIONS
\f[B]Endpoint Options (Required)\f[R] If both endpoints are remote, the
default behavior will be a \f[B]pull replication\f[R]
(\f[CR]\(rs\-\-pull\f[R]).
This requires that the \f[I]target\f[R] user must have ssh access to the
\f[I]source\f[R], typically provided by using an \f[CR]ssh\f[R] key or
agent forwarding.
For help with advanced \f[CR]ssh\f[R] configuration, see the
\f[I]https://zelta.space\f[R] wiki.
.TP
\f[I]source\f[R]
The dataset which will be synced with its descendants.
If a snapshot is given, it will be used as the last synced snapshot.
If no snapshot is \f[I]target\f[R]
The dataset which will be updated.
.PP
\f[B]Output Options\f[R]*
.TP
\f[B]\-v, \-\-verbose\f[R]
Increase verbosity.
Specify once for operational detail, twice (\f[CR]\-vv\f[R]) for debug
output.
.TP
\f[B]\-q, \-\-quiet\f[R]
Quiet output.
Specify once to suppress warnings, twice (\f[CR]\-qq\f[R]) to suppress
errors.
.TP
\f[B]\-n, \-\-dryrun, \-\-dry\-run\f[R]
Display \f[CR]zfs\f[R] commands without executing them.
.TP
\f[B]\-d, \-\-depth\f[R] \f[I]LEVELS\f[R]
Limit recursion depth.
For example, a depth of 1 includes only the specified dataset.
.TP
\f[B]\-\-exclude, \-X\f[R] \f[I]PATTERN\f[R]
Exclude /dataset/suffix, \(atsnapshot, or #bookmark beginning with the
indicated symbol.
Wildcards \f[CR]?\f[R] and \f[CR]*\f[R] are permitted.
See \f[B]zelta\-match(8)\f[R].
.TP
\f[B]\-j, \-\-json\f[R]
Print JSON output.
See \f[B]zelta\-options(8)\f[R] for details.
.PP
\f[B]Connection Options\f[R]
.TP
\f[B]\-\-push,\-\-pull,\-\-sync\-direction\f[R] \f[I]DIRECTION\f[R]
When both endpoints are remote, use \f[CR]PULL\f[R] (default) or
\f[CR]PUSH\f[R] sync direction.
.TP
\f[B]\-\-recv\-pipe\f[R] \f[I]COMMAND\f[R]
Pipe \f[CR]zfs receive\f[R] output through the indicated command, such
as \f[CR]dd status=progress\f[R].
.PP
\f[B]Snapshot Options\f[R]
.TP
\f[B]\-\-no\-snapshot\f[R]
Do not snapshot.
.TP
\f[B]\-\-snapshot\-always\f[R]
Snapshot even if the \f[I]source\f[R] has no written data in need of
one.
.TP
\f[B]\-\-snap\-name\f[R] \f[I]NAME\f[R]
Specify snapshot name.
Use \f[CR]$(command)\f[R] for dynamic generation.
Default: \f[CR]$(date \-u +zelta_%Y\-%m\-%d_%H.%M.%S)\f[R].
.TP
\f[B]\-\-snap\-mode\f[R] \f[I]MODE\f[R]
Specify when to snapshot: \f[CR]0\f[R] (never), \f[CR]IF_NEEDED\f[R]
(default, only if source has new data), or \f[CR]ALWAYS\f[R].
.PP
\f[B]Sync Options\f[R]
.TP
\f[B]\-\-send\-check\f[R]
Attempt to drop unsupported \f[CR]zfs send\f[R] options using a no\-op
test prior to replication.
Not fully implemented.
.TP
\f[B]\-\-rotate\f[R]
Rename the target dataset and sync a clone via delta from the source or
source origin clone.
See \f[B]zelta help rotate\f[R].
.TP
\f[B]\-R, \-\-replicate\f[R]
Use \f[B]zfs send \-\-replicate\f[R] instead of Zelta\(cqs per\-snapshot
analysis.
.TP
\f[B]\-I\f[R]
Sync all possible source snapshots using \f[CR]zfs send \-I\f[R] for
updates.
This is the default behavior.
See \f[B]\-i\f[R] to disable this behavior.
.TP
\f[B]\-\-resume,\-\-no\-resume\f[R]
Enable (default) or disable automatic resume of interrupted syncs.
.PP
\f[B]Override Options\f[R] As a convenience feature, all options for
\f[CR]zfs send\f[R] and/or \f[CR]zfs recv\f[R] may be overridden.
In most circumstances, these defaults should be overridden in
\f[CR]zelta.env\f[R].
See \f[CR]zelta help options\f[R] for more details.
.TP
\f[B]\-b,\-\-backup,\-c,\-\-compressed,\-D,\-\-dedup,\-e,\-\-embed,\-h,\-\-holds,\-L,\-\-largeblock,\-p,\-\-parsable,\-\-proctitle,\-\-props,\-\-raw,\-\-skipmissing,\-V,\-w\f[R]
Override default \f[CR]zfs send\f[R] options.
For precise configuration, use \f[CR]ZELTA_SEND_*\f[R] environment
variables instead.
See \f[B]zelta\-options(8)\f[R].
.TP
\f[B]\-e,\-h,\-M,\-u\f[R]
Override default \f[CR]zfs receive\f[R] options.
For precise configuration, use \f[CR]ZELTA_RECV_*\f[R] environment
variables instead.
See \f[B]zelta\-options(8)\f[R].
.SH NOTES
See \f[B]zelta\-options(8)\f[R] for more information about options that
can be configured via the environment, \f[CR]zelta.env\f[R], and
\f[CR]zelta policy\f[R].
.PP
The \f[CR]zelta sync\f[R] command is a convenience alias for
\f[CR]zelta backup \-i\f[R] and may be extended in future versions with
additional optimizations for continuous replication workflows.
.SH EXAMPLES
The same command works for both new and existing target datasets.
.PP
Local replication with automatic snapshot creation:
.IP
.EX
zelta backup tank/source/dataset tank/target/dataset
.EE
.PP
Remote to local synchronization:
.IP
.EX
zelta backup remote_host:tank/source/dataset tank/target/dataset
.EE
.PP
Dry run to preview commands:
.IP
.EX
zelta backup \-n tank/source/dataset tank/target/dataset
.EE
.PP
Replicate with custom snapshot naming:
.IP
.EX
zelta backup \(rs\-\-snap\-name \(dqbackup_$(date +%Y%m%d)\(dq \(rs
    tank/source tank/backups/source
.EE
.PP
Limit recursion depth:
.IP
.EX
zelta backup \-d 2 tank/source tank/target
.EE
.SH EXIT STATUS
Returns 0 on success, non\-zero on error.
.SH SEE ALSO
zelta(8), zelta\-options(7), zelta\-match(8), zelta\-policy(8),
zelta\-clone(8), zelta\-revert(8), zelta\-rotate(8), ssh(1), zfs(8)
.SH AUTHORS
Daniel J. Bell <\f[I]bellhyve\(atzelta.space\f[R]>
.SH WWW
https://zelta.space
